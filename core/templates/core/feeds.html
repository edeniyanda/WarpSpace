{% extends 'core/base.html' %}

{% block content %}
<div class="container">
    <div class="columns is-centered">
        <div class="column is-half">
            <!-- Post Form -->
            <div class="box">
                <form method="POST" action="{% url 'create_post' %}" enctype="multipart/form-data">
                    {% csrf_token %}

                    <!-- Content Field -->
                    <div class="field">
                        <div class="control">
                            {{ form.content }}
                        </div>
                    </div>

                    <!-- Image Upload Field with Preview -->
                    <div class="field">
                        <div class="file has-name is-fullwidth">
                            <label class="file-label">
                                {{ form.image }}
                                <span class="file-cta">
                                    <span class="file-icon">
                                        <i class="fas fa-upload"></i>
                                    </span>
                                    <span class="file-label">Choose an imageâ€¦</span>
                                </span>
                                <span class="file-name" id="file-name">No file selected</span>
                            </label>
                        </div>
                    </div>

                    <!-- Image Preview -->
                    <div class="field">
                        <figure class="image ">
                            <img id="image-preview" src="#" alt="Image Preview" style="display: none;" class="">
                        </figure>
                    </div>

                    <!-- Submit Button -->
                    <div class="field">
                        <div class="control">
                            <button type="submit" class="button is-info is-fullwidth">Post</button>
                        </div>
                    </div>
                </form>
            </div>


        <!-- Feed Posts -->
        {% for post in posts %}
            <div class="box">
                <article class="media">
                    <div class="media-left">
                        <figure class="image is-48x48">
                            <img src="{{ post.user.profile.profileimg.url }}" alt="{{ post.user.username }}" class="is-rounded">
                        </figure>
                    </div>
                    <div class="media-content">
                        <div class="content">
                            <p>
                                <a href="{% url 'profile' post.user.username %}">
                                    <strong>{{ post.user.username }}</strong>
                                </a>
                                <br>
                                {{ post.content }}
                                <br>
                                <small>{{ post.created_at }}</small>
                            </p>
                            
                            <!-- Display Post Image if Exists -->
                            {% if post.image %}
                                <figure class="image ">
                                    <img src="{{ post.image.url }}" alt="Post Image">
                                </figure>
                            {% endif %}
                        </div>
                        <nav class="level is-mobile">
                            <div class="level-left">
                                <a class="level-item" href="{% url 'like_post' post.id %}">
                                    <span class="icon is-small"><i class="fas fa-heart"></i></span>
                                    <span>{{ post.likes.count }}</span>
                                </a>
                                <a class="level-item" href="{% url 'repost' post.id %}">
                                    <span class="icon is-small"><i class="fas fa-retweet"></i></span>
                                    <span>{{ post.reposts.count }}</span>
                                </a>
                            </div>
                        </nav>
                    </div>
                </article>
            </div>
        {% endfor %}

        </div>
    </div>
</div>
{% endblock %}
{% block script %}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const fileInput = document.querySelector('.file-input');
        const fileName = document.getElementById('file-name');
        const imagePreview = document.getElementById('image-preview');

        fileInput.addEventListener('change', () => {
            const file = fileInput.files[0];

            if (file) {
                // Show the file name
                fileName.textContent = file.name;

                // Create a file reader to display the image preview
                const reader = new FileReader();

                reader.onload = function(e) {
                    // Set the src of the image preview to the file content
                    imagePreview.src = e.target.result;
                    imagePreview.style.display = 'block';  // Show the image
                }

                reader.readAsDataURL(file);
            } else {
                // Hide the image preview if no file is selected
                imagePreview.style.display = 'none';
            }
        });
    });
</script>


{% endblock %}
